# Copilot Instructions (Project-Wide)

Този файл описва **как AI-агентът трябва да работи в това репо**. Целта е промени да са предвидими, минимални и съобразени с текущата архитектура и UX.

## 1) Контекст на проекта

- **Приложение**: Medical Schedule — система за записване на часове при лекари.
- **Frontend**: Vanilla JavaScript (ES modules), HTML, CSS, Bootstrap 5.
- **Build**: Vite.
- **Backend**: Supabase (PostgreSQL + Auth + RLS) + Supabase Edge Function за изтриване на потребители.
- **Hosting**: Netlify (SPA redirects са конфигурирани).

## 2) Архитектура и структура

Следвай съществуващата структура и именуване:

- `src/pages/` — страници (напр. `home.js`, `schedule.js`, `doctors.js`, `settings.js`, `auth.js`).
- `src/components/` — преизползваеми UI компоненти.
- `src/services/` — инфраструктура/бизнес логика (Supabase клиент, router, theme, event bus).
- `src/styles/` — CSS стилове.
- `public/` — статични файлове и redirects.

Правила:
- Не въвеждай нова архитектура (React/Vue, state managers, сложни build стъпки) без изрично искане.
- Пази кода **модулен**: логика в `services/`, UI в `pages/`/`components/`.
- Не редактирай генерирани файлове в `dist/`.

## 3) Роутинг и навигация

- Приложението използва **hash-базирана навигация**.
- При промени по страници/маршрути:
  - Съобразявай се със съществуващия router в `src/services/router.js`.
  - Не добавяй нови страници/маршрути, ако не са изрично поискани.

## 4) UI/UX правила

- Използвай Bootstrap 5 компоненти и класове; придържай се към съществуващия стил.
- Не добавяй “nice-to-have” UI (допълнителни модали, филтри, анимации, панели) освен ако задачата го изисква.
- Използвай съществуващата тема (светла/тъмна) и логиката в `src/services/theme.js`.
- Не хардкодвай нови цветове/шрифтове/сенки без да е част от текущите стилове.

## 5) Роли и права (AuthZ)

В проекта има реално имплементирани роли и функции за:

- **Пациент** — записване/преглед на собствени часове.
- **Лекар** — преглед на график, работни часове, детайли за собствени записи.
- **Администратор** — специални права и администраторски панел.

Администраторският достъп е имплементиран през таблица `admins` (активен при `is_active = true`) и workflow за заявки в `admin_requests`.

Правила за промени по права:
- Не понижавай сигурността “за удобство”.
- Всяка промяна по достъп до данни трябва да е съвместима с RLS политиките.
- Проверка за админ сесия трябва да остане централизирана (напр. `requireAdminSession()` където е налично).

## 6) Supabase и база данни

- Използвай Supabase клиента от `src/services/supabase.js`.
- Предпочитай минимални заявки (`select` само нужните колони).
- Съобразявай се с RLS — не разчитай на client-side филтри за защита.

### 6.1) Промени по schema / миграции

- Не редактирай вече приложени SQL “миграции” в Supabase.
- При schema промяна: добавяй **нов SQL файл** в `supabase/migrations/` (напр. `supabase/migrations/ADD_*.sql`) и документирай стъпките.
- Ако има rollback/restore скриптове — поддържай ги синхронизирани.

### 6.2) Поверителност на данните

- Пациентски данни (име, телефон, оплаквания) са чувствителни.
- Не показвай оплаквания/лични данни в UI на потребители без права.
- При промени по UI, пази текущите ограничения кой вижда детайли.

## 7) Edge Functions / админ операции

- За разрушителни админ операции (напр. изтриване на потребител) използвай съществуващия подход със Supabase Edge Function (напр. `supabase/functions/delete-user`).
- Не добавяй нови admin endpoints/функции без изрично изискване.

## 8) Качество на кода

- ES6+; използвай `async/await` и ясна обработка на грешки.
- Пази публичните API-та/сигнатури, освен ако задачата изисква промяна.
- Не въвеждай нови зависимости без причина. Ако се налага — обоснови и обнови `package.json`.
- Поддържай текста/UX съобщенията на **български**, освен ако проектът изрично не изисква друго.

## 9) Валидация и проверки

Преди да приключиш задача, когато е приложимо:
- Стартирай `npm run build` за да хванеш синтактични/импорт грешки.
- Ако промените засягат runtime: `npm run dev` и бърз sanity check на засегнатите екрани.
- Не “поправяй” несвързани проблеми/предупреждения извън задачата.

## 10) Документация

- Ако променяш функционалност: обновявай [README.md](../README.md) и релевантните `.md`/SQL guide файлове.
- Не описвай вече имплементирани функции като “бъдещи идеи” (особено за админ панела/админ права).

## 11) Работа в този репо (оперативни правила)

- Минимални, фокусирани промени.
- Не добавяй нови страници/модули “за всеки случай”.
- Не пипай `dist/`.
- Ако правиш файлови операции, предпочитай стандартните пътища (напр. `.github/copilot-instructions.md` за инструкции).
